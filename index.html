<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <title>Last Update Time</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            .update-time { font-size: 1.5em; color: #2d8cf0; }
            label { display: inline-block; width: 140px; }
            input[readonly] { margin-bottom: 6px; }
            table { border-collapse: collapse; margin-top: 10px; }
            th, td { border: 1px solid #ccc; padding: 4px 8px; font-size: 14px; }
            th { background: #f5f5f5; }
        </style>
    </head>
    <body>
    <h1>UNF-Aktivite-ics</h1>
        <h2>Last Update Time</h2>
        <div class="update-time" id="update-time">
            <span id="last-update-utc">UTC: null</span><br />
            <span id="current-time-ref" style="font-size:0.9em;color:#888;"></span><br />
            <span id="local-timezone" style="font-size:0.9em;color:#888;"></span>
        </div>

        <h2>ICS subscription links</h2>
        <div id="ics-links"></div>

        <h2>Published Files</h2>
        <div id="file-list">
            <!-- FILE_LIST_START -->
            <span id="no-files" style="color:#888;"></span>
            <!-- FILE_LIST_END -->
        </div>


        <script>
    // Auto refresh the page every 5 minutes
    setInterval(function() { location.reload(); }, 300000);
            // Dynamically insert ICS subscription links, filenames are synchronized with Python
            const icsFiles = [
                { slug: 'kbh', name: 'UNF KÃ¸benhavn' },
                { slug: 'lyngby', name: 'UNF Lyngby' },
                { slug: 'aarhus', name: 'UNF Aarhus' },
                { slug: 'odense', name: 'UNF Odense' },
                { slug: 'aalborg', name: 'UNF Aalborg' },
                { slug: 'danmark', name: 'UNF Danmark' },
            ];
            const baseUrl = `https://teddypyf.github.io/UNF-Aktivite-Web-Scraper/`;
            let html = '';
            icsFiles.forEach((f, i) => {
                const fname = `unf_events_${f.slug}.ics`;
                html += `<label for="ics-link${i}">${f.name}:</label>`;
                html += `<input id="ics-link${i}" type="text" value="${baseUrl}${fname}" readonly style="width:500px;" onclick="this.select()" /><br />`;
            });
            document.getElementById('ics-links').innerHTML = html;
        </script>
        <script>
            // Only format conversion: UTC time is inserted by backend, JS automatically formats local time as yyyy-MM-dd HH:mm:ss, and displays browser timezone
            const utcSpan = document.getElementById('last-update-utc');
            const tzSpan = document.getElementById('local-timezone');
            const currentRefSpan = document.getElementById('current-time-ref');
            function formatNormal(d) {
                return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0') + ' ' + String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0') + ':' + String(d.getSeconds()).padStart(2,'0');
            }
            let utcText = utcSpan.textContent;
            let match = utcText.match(/UTC: (\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z)/);
            let browserTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            let offsetMin = -new Date().getTimezoneOffset();
            let sign = offsetMin >= 0 ? '+' : '-';
            let absMin = Math.abs(offsetMin);
            let offsetStr = sign + String(Math.floor(absMin/60)).padStart(2, '0') + ':' + String(absMin%60).padStart(2, '0');
            if (match) {
                let utcDate = new Date(match[1]);
                utcSpan.textContent = 'UTC: ' + formatNormal(utcDate);
            }
            tzSpan.textContent = 'Browser Timezone: ' + browserTz + ' (offset ' + offsetStr + ')';
            function updateCurrentRef() {
                const now = new Date();
                currentRefSpan.textContent = 'Current Time: ' + formatNormal(now);
            }
            updateCurrentRef();
            setInterval(updateCurrentRef, 60000);

    // Show a hint when the file list is empty
        window.addEventListener('DOMContentLoaded', function() {
            var fileList = document.getElementById('file-list');
            var noFiles = document.getElementById('no-files');
            if (fileList && noFiles && fileList.innerText.trim() === '') {
                noFiles.textContent = 'No files published.';
            }
        });
        </script>
    </body>
</html>
