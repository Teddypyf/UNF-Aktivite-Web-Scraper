<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <title>Last Update Time</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            .update-time { font-size: 1.5em; color: #2d8cf0; }
            label { display: inline-block; width: 140px; }
            input[readonly] { margin-bottom: 6px; }
            table { border-collapse: collapse; margin-top: 10px; }
            th, td { border: 1px solid #ccc; padding: 4px 8px; font-size: 14px; }
            th { background: #f5f5f5; }
        </style>
    </head>
    <body>
        <h1>UNF-Aktivite-ics</h1>
        <h2>Last Update Time</h2>
        <div class="update-time" id="update-time">
            <span id="last-update-utc">UTC: null</span><br />
            <span id="last-update-local">Local: null</span><br />
            <span id="local-timezone" style="font-size:0.9em;color:#888;"></span>
        </div>

        <h2>ICS subscription links</h2>
        <div id="ics-links"></div>

        <h2>Published Files</h2>
        <div id="file-list">
            <!-- FILE_LIST_START -->
            <!-- FILE_LIST_END -->
        </div>


        <script>
            // 动态插入 ICS 订阅链接, 文件名与 Python 同步
            const icsFiles = [
                { slug: 'kbh', name: 'UNF København' },
                { slug: 'lyngby', name: 'UNF Lyngby' },
                { slug: 'aarhus', name: 'UNF Aarhus' },
                { slug: 'odense', name: 'UNF Odense' },
                { slug: 'aalborg', name: 'UNF Aalborg' },
                { slug: 'danmark', name: 'UNF Danmark' },
            ];
            const baseUrl = `https://teddypyf.github.io/UNF-Aktivite-Web-Scraper/`;
            let html = '';
            icsFiles.forEach((f, i) => {
                const fname = `unf_events_${f.slug}.ics`;
                html += `<label for="ics-link${i}">${f.name}:</label>`;
                html += `<input id="ics-link${i}" type="text" value="${baseUrl}${fname}" readonly style="width:500px;" onclick="this.select()" /><br />`;
            });
            document.getElementById('ics-links').innerHTML = html;
        </script>
        <script>
            // 只做格式转换：UTC时间由后端插入，JS自动格式化本地时间为 yyyy-MM-dd HH:mm:ss，并展示浏览器时区
            const utcSpan = document.getElementById('last-update-utc');
            const localSpan = document.getElementById('last-update-local');
            const tzSpan = document.getElementById('local-timezone');
            let utcText = utcSpan.textContent;
            let match = utcText.match(/UTC: (\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z)/);
            function pad(n) { return n < 10 ? '0' + n : n; }
            function formatDate(d) {
                return (
                    d.getFullYear() +
                    '-' + pad(d.getMonth() + 1) +
                    '-' + pad(d.getDate()) +
                    ' ' + pad(d.getHours()) +
                    ':' + pad(d.getMinutes()) +
                    ':' + pad(d.getSeconds())
                );
            }
            if (match) {
                let utcDate = new Date(match[1]); // ISO 格式直接解析
                utcSpan.textContent = 'UTC: ' + formatDate(utcDate);
                // 本地时间格式化
                function formatLocalDate(d) {
                    return (
                        d.getFullYear() +
                        '-' + pad(d.getMonth() + 1) +
                        '-' + pad(d.getDate()) +
                        ' ' + pad(d.getHours()) +
                        ':' + pad(d.getMinutes()) +
                        ':' + pad(d.getSeconds())
                    );
                }
                localSpan.textContent = 'Local: ' + formatLocalDate(utcDate);
                tzSpan.textContent = 'Timezone: ' + Intl.DateTimeFormat().resolvedOptions().timeZone;
            } else {
                tzSpan.textContent = 'Timezone: ' + Intl.DateTimeFormat().resolvedOptions().timeZone;
            }
        </script>
    </body>
</html>
